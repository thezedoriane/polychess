#python-chess import 
#https://github.com/niklasf/python-chess
import chess

#used to access Polyglot book
import chess.polyglot

import chess.svg
from IPython.display import SVG
   
#set the initial position
board = chess.Board()
print(board)

# Si la position est dans Polyglot 
# regarder les coups proposés avec les pondérations
# jouer le coup     

def meilleur_choix(board):
    
    #creer une liste coup
    #c'est une liste composee par les listes
    l_coup=[]
    #access the Polyglot book
    #entry.move() : les mouvement, representer par binaire
    #entry.weight : les pondérations jouer le coup
    #entry.learn : Une autre valeur entière qui peut être utilisée pour d'autres informations
    with chess.polyglot.open_reader("bookfish.bin") as reader:
        for entry in reader.find_all(board):
            l_coup.append([entry.move(), entry.weight, entry.learn])

        #dans la liste des coups, choisir le meilleur coups
        ponderation = 0
        indice = 0
        if l_coup == []:
            return "il n'y a pas de mouvement"
        else:
            for i in range (len(l_coup)):
            # comparer le pondération pour chaque mouvement
            #ponderation: l_coup[][1]
                if l_coup[i][1] > ponderation :
                    indice = i
                    ponderation = l_coup[i][1]
            #retourner le mouvement
            return l_coup[indice][0]


def IAvsIA():
    #liste permettant d'enregistrer les coups joues
    coup=[]
    #tant que la partie n'est pas finie
    while (not board.is_game_over()):
        #on recupere la position
        fen=board.fen()
        #on recupere les coups possible
        possibilite=board.legal_moves
        #on regarde si la position est dans polyglot
        #si elle n'y est pas on utilise la fonction minmax pour trouver le meilleur coup
        if meilleur_choix(board) == "il n'y a pas de mouvement":
            nextmove=minmax(5,board)
            board.push(nextmove)
            #affichage du plateau une fois le coup joue
            display (SVG(chess.svg.board(board=board, lastmove=nextmove)))
        #si elle y est on joue le meilleur coup
        elif meilleur_choix(board) in possibilite :
            nextmove=meilleur_choix(board)
            board.push(nextmove)
            #affichage du plateau une fois le coup joue
            display(SVG(chess.svg.board(board=board, lastmove=nextmove)))
        #on enregistre le mouvement
        coup.append(nextmove)
        #si une des conditions d'arret du jeu est rempli la partie est fini et on affiche le resultat
        if board.is_game_over():
            print("Game Over")
            print(board.result())
    
def IAvsHumain():
        #liste permettant d'enregistrer les coups joues
        coup=[]
        #tant que la partie n'est pas finie
        while (not board.is_game_over()):
            #on recupere la position
            fen=board.fen()
            #on recupere les coups possible
            possibilite=board.legal_moves
            #tour humain
            deplacePlayer(coup)
            #si game over la partie est finie
            if board.is_game_over():
                print("Game Over")
                print(board.result())
            #tour IA
            #on regarde si la position est dans polyglot
            #si elle n'y est pas on utilise la fonction minmax pour trouver le meilleur coup
            if meilleur_choix(board) == "il n'y a pas de mouvement":
                #minimax
                nextmove=minmax(5,board)
                board.push(nextmove)
                #affichage du plateau une fois le coup joue
                display(SVG(chess.svg.board(board=board, lastmove=nextmove)))
            #si elle y est on joue le meilleur coup
            elif meilleur_choix(board) in possibilite :
                nextmove=meilleur_choix(board)
                board.push(nextmove)
                #affichage du plateau une fois le coup joue
                display(SVG(chess.svg.board(board=board, lastmove=nextmove)))
            #on enregistre le mouvement
            coup.append(nextmove)
            #si une des conditions d'arret du jeu est rempli la partie est fini et on affiche le resultat
            if board.is_game_over():
                print("Game Over")
                print(board.result()
       
